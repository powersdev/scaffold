"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Env = void 0;
const bud_support_1 = require("@roots/bud-support");
const node_path_1 = require("node:path");
/**
 * Env context
 * @public
 */
class Env {
    /**
     * Constructor
     * @param baseDirectory -- nearest directory containing package.json from root
     * @public
     */
    constructor(baseDirectory) {
        let values = {};
        Object.entries(process.env).map(([k, v]) => {
            values[k] = v;
        });
        const get = (path) => {
            const { parsed, error } = bud_support_1.dotenv.config({ path });
            if (error || !parsed)
                return;
            const expanded = (0, bud_support_1.dotenvExpand)(parsed);
            if (!expanded)
                return;
            Object.entries(expanded).map(([k, v]) => {
                values[k] = v;
            });
        };
        baseDirectory.split('/').reduce((a, c) => {
            const next = (0, node_path_1.join)(a, c);
            get((0, node_path_1.join)(next, '.env'));
            return next;
        }, `/`);
        Object.entries(values).map(([k, v]) => {
            this[k] = v;
        });
    }
}
exports.Env = Env;
