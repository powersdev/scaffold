"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Command = void 0;
const child_process_1 = require("child_process");
/**
 * Base command
 *
 * @public
 */
class Command {
    /**
     * @public
     */
    constructor(path, onMessage) {
        this.path = path;
        if (onMessage)
            this.onMessage = onMessage;
    }
    /**
     * @public
     */
    onMessage(message) {
        return null;
    }
    /**
     * @public
     */
    static execute(onMessage, ...commandArgs) {
        return new Promise((resolve, reject) => {
            const command = (0, child_process_1.spawn)(commandArgs.shift(), commandArgs);
            onMessage &&
                command.stdout.on('data', message => onMessage(message.toString()));
            command.on('close', resolve);
            command.on('error', reject);
        });
    }
    /**
     * @public
     */
    static normalizeDependencies(dependencies) {
        return dependencies
            .reduce((acc, dependency) => {
            if (Array.isArray(dependency)) {
                acc.push(`${dependency[0]}@${dependency[1]}`);
            }
            else {
                acc.push(dependency);
            }
            return acc;
        }, [])
            .filter(Boolean);
    }
}
exports.Command = Command;
