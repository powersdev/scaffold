"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.use = void 0;
const use_dependencies_1 = require("./use.dependencies");
const use_utilities_1 = require("./use.utilities");
const use = async function (source) {
    const bud = this;
    const addExtension = async (source) => {
        if (!source) {
            bud.error(`extension source is not defined. skipping`);
        }
        if (!source.hasOwnProperty('name')) {
            source.name = (0, use_utilities_1.generateName)(source);
        }
        if (bud.extensions.has(source.name)) {
            bud.info(`extension "${source.name}" is already registered. skipping`);
            return bud;
        }
        await bud.extensions.add((0, use_utilities_1.isCompilerPlugin)(source) ? { ...source, make: () => source } : source);
    };
    !(0, use_dependencies_1.isArray)(source)
        ? await addExtension(source)
        : await Promise.all(source.map(async (ext) => await addExtension(ext)));
    return bud;
};
exports.use = use;
