"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.minimize = void 0;
const bud_support_1 = require("@roots/bud-support");
const minimize_constants_1 = require("./minimize.constants");
const minimize_dependencies_1 = require("./minimize.dependencies");
const { isUndefined } = bud_support_1.lodash;
/**
 * Enables minification of built assets.
 *
 * @example
 * Enable:
 *
 * ```js
 * bud.minimize()
 * ```
 *
 * @example
 * Explicitly disable:
 *
 * ```js
 * bud.minimize(false)
 * ```
 *
 * @example
 * Explicitly enable:
 *
 * ```js
 * bud.minimize(true)
 * ```
 *
 * @public
 */
const minimize = function (input, options) {
    const ctx = this;
    if (input === false) {
        ctx.hooks.on('build.optimization.minimize', false);
    }
    if (isUndefined(input) || input === true) {
        ctx.hooks.on('build.optimization.minimize', true);
    }
    ctx.hooks.on('build.optimization.minimizer', (minimizer) => {
        minimizer.push(...(minimizer.includes('...') ? [] : ['...']), new minimize_dependencies_1.CssMinimizer({
            ...minimize_constants_1.cssMinimizerOptions,
            ...(options?.css ?? {}),
        }));
        return minimizer;
    });
    return ctx;
};
exports.minimize = minimize;
